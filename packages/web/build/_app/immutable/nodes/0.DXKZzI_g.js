import{c as R,a as i,t as $,s as Z,b as ke,d as De,e as je,f as Se,g as Ke}from"../chunks/DqkJwZYL.js";import{f as K,e as Ce,i as o,r,s as v,g as ze,j as e,t as q,k as re,w as He,a8 as Ze,a9 as pe,G as j,n as Pe,au as Le,av as Ge}from"../chunks/DXlRHvn5.js";import{l as ne,s as ce,i as F,a as ve}from"../chunks/BdB0C_9E.js";import{I as ie,b as le,e as fe,i as me,r as Oe,u as Fe,c as xe,a as he,s as Ve}from"../chunks/BQ3ExOcy.js";import{g as _e}from"../chunks/C1Q5H8Mv.js";import{p as ge}from"../chunks/AMBKYCc2.js";import{P as We,G as Re}from"../chunks/DspAWYAj.js";import{c as Be}from"../chunks/B7TfO0g5.js";import{z as g,u as oe,X as $e,b as Qe,S as Ue,s as Ee}from"../chunks/CNYwChdC.js";import"../chunks/9xNfiEXT.js";const Xe=!1,Kt=Object.freeze(Object.defineProperty({__proto__:null,ssr:Xe},Symbol.toStringTag,{value:"Module"}));function Je(h,a){const s=ne(a,["children","$$slots","$$events","$$legacy"]);ie(h,ce({name:"menu"},()=>s,{iconNode:[["line",{x1:"4",x2:"20",y1:"12",y2:"12"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18"}]],children:(c,N)=>{var u=R(),m=K(u);le(m,a,"default",{}),i(c,u)},$$slots:{default:!0}}))}function qe(h,a){const s=ne(a,["children","$$slots","$$events","$$legacy"]);ie(h,ce({name:"message-square-text"},()=>s,{iconNode:[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M13 8H7"}],["path",{d:"M17 12H7"}]],children:(c,N)=>{var u=R(),m=K(u);le(m,a,"default",{}),i(c,u)},$$slots:{default:!0}}))}function Me(h,a){const s=ne(a,["children","$$slots","$$events","$$legacy"]);ie(h,ce({name:"messages-square"},()=>s,{iconNode:[["path",{d:"M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"}]],children:(c,N)=>{var u=R(),m=K(u);le(m,a,"default",{}),i(c,u)},$$slots:{default:!0}}))}function Ye(h,a){const s=ne(a,["children","$$slots","$$events","$$legacy"]);ie(h,ce({name:"pencil"},()=>s,{iconNode:[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]],children:(c,N)=>{var u=R(),m=K(u);le(m,a,"default",{}),i(c,u)},$$slots:{default:!0}}))}function et(h,a){const s=ne(a,["children","$$slots","$$events","$$legacy"]);ie(h,ce({name:"power"},()=>s,{iconNode:[["path",{d:"M12 2v10"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04"}]],children:(c,N)=>{var u=R(),m=K(u);le(m,a,"default",{}),i(c,u)},$$slots:{default:!0}}))}function Ie(h,a){const s=ne(a,["children","$$slots","$$events","$$legacy"]);ie(h,ce({name:"search"},()=>s,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["path",{d:"m21 21-4.3-4.3"}]],children:(c,N)=>{var u=R(),m=K(u);le(m,a,"default",{}),i(c,u)},$$slots:{default:!0}}))}var tt=$('<span class="bg-yellow-200"> </span>'),at=$('<span class="bg-yellow-200"> </span>'),rt=$('<p class="text-sm text-gray-500 line-clamp-2"></p>'),st=$('<p class="text-sm text-gray-500 line-clamp-2"> </p>'),ot=$('<p class="text-sm text-gray-500 line-clamp-2"> </p>'),nt=$('<div class="flex items-start gap-2"><div class="flex-shrink-0 py-1.5"><!></div> <div class="overflow-hidden"><h4 class="font-medium text-gray-800 truncate"><!></h4> <!></div></div>');function ct(h,a){Ce(a,!0);var s=nt(),l=o(s),c=o(l);{var N=d=>{qe(d,{size:20})},u=d=>{Me(d,{size:20})};F(c,d=>{a.chat.userId===g.current.userID?d(N):d(u,!1)})}r(l);var m=v(l,2),C=o(m),B=o(C);{var Q=d=>{var w=R();const D=re(()=>a.chat.title.split(new RegExp(`(${a.search})`,"i")));var S=K(w);fe(S,17,()=>e(D),me,(z,k)=>{var p=R(),O=K(p);{var V=y=>{var M=tt(),J=o(M,!0);r(M),q(()=>Z(J,e(k))),i(y,M)},T=y=>{var M=ke();q(()=>Z(M,e(k))),i(y,M)};F(O,y=>{e(k).toLowerCase()===a.search.toLowerCase()?y(V):y(T,!1)})}i(z,p)}),i(d,w)},U=d=>{var w=ke();q(()=>Z(w,a.chat.title)),i(d,w)};F(B,d=>{a.chat.title.toLowerCase().includes(a.search.toLowerCase())?d(Q):d(U,!1)})}r(C);var x=v(C,2);{var A=d=>{var w=R();const D=re(()=>a.chat.messages.flatMap(p=>p.chunks||[]).find(p=>p.content.toLowerCase().includes(a.search.toLowerCase())));var S=K(w);{var z=p=>{var O=rt();const V=re(()=>e(D).content.split(new RegExp(`(${a.search})`,"i")));fe(O,21,()=>e(V),me,(T,y)=>{var M=R(),J=K(M);{var se=b=>{var L=at(),Y=o(L,!0);r(L),q(()=>Z(Y,e(y))),i(b,L)},f=b=>{var L=ke();q(()=>Z(L,e(y))),i(b,L)};F(J,b=>{e(y).toLowerCase()===a.search.toLowerCase()?b(se):b(f,!1)})}i(T,M)}),r(O),i(p,O)},k=(p,O)=>{{var V=T=>{var y=st(),M=o(y,!0);r(y),q(()=>Z(M,a.chat.description)),i(T,y)};F(p,T=>{a.chat.description&&T(V)},O)}};F(S,p=>{e(D)?p(z):p(k,!1)})}i(d,w)},G=(d,w)=>{{var D=S=>{var z=ot(),k=o(z,!0);r(z),q(()=>Z(k,a.chat.description)),i(S,z)};F(d,S=>{a.chat.description&&S(D)},w)}};F(x,d=>{a.chat.messages&&a.chat.messages.length>0?d(A):d(G,!1)})}r(m),r(s),i(h,s),ze()}var it=(h,a)=>{var s;return(s=e(a))==null?void 0:s.showModal()},lt=(h,a)=>{var s;return(s=e(a))==null?void 0:s.showModal()},dt=(h,a)=>{var s;return(s=e(a))==null?void 0:s.close()},ut=$("<button><!> </button>"),vt=$('<div class="flex flex-col text-gray-500 p-2"><div class="ps-3 text-sm font-medium pb-1">Shortcuts</div> <!></div>'),ht=(h,a)=>{var s;return(s=e(a))==null?void 0:s.close()},ft=$("<li><a><!></a></li>"),mt=$('<div class="ps-3 text-sm font-medium pb-1">Chats</div> <ul class="divide-y divide-gray-200"></ul>',1),pt=$('<p class="text-center p-4 text-gray-500"><span class="text-gray-500">No results found for</span> "<span class="inline-block max-w-[200px] truncate align-bottom"> </span>"</p>'),_t=$('<div class="flex flex-col text-gray-500 p-2"><!></div>'),gt=$('<div class="max-w-md grow"><div class="relative"><button type="button" class="hidden md:flex w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-1 focus:ring-gray-400 focus:border-transparent text-left text-gray-500">Search...</button> <div class="hidden md:block absolute left-3 top-2.5 text-gray-400"><!></div> <button class="md:hidden p-2 rounded-md text-gray-600 hover:text-gray-900 active:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-gray-400" aria-label="Search"><!></button></div> <dialog id="searchModal" class="max-h-full md:rounded-lg shadow-lg w-full max-w-xl md:mx-auto md:mt-[20vh] inset-0 h-full m-0 md:h-fit"><div class="relative p-1 mb-2 border-b border-gray-200"><input type="search" placeholder="Type to search..." class="w-full pl-10 pr-4 py-2 focus:outline-none focus:border-transparent"> <div class="absolute left-4 top-3.5 text-gray-400"><!></div> <div class="absolute right-4 top-3.5 text-gray-400"><button class="text-gray-500 hover:text-gray-700" aria-label="Close search modal"><!></button></div></div> <div class="max-h-100 overflow-auto"><!> <!></div></dialog></div>');function xt(h,a){Ce(a,!0);let s=pe(""),l=pe(0),c=pe(null);const N=oe(()=>g.current.query.chats.where(t=>t.or(t.cmp("userId",g.current.userID),t.exists("chatAccess",n=>n.where("userId",g.current.userID)))).where("title","ILIKE",`%${e(s)}%`).related("messages",t=>t.related("chunks"))),u=oe(()=>g.current.query.messages.whereExists("chat",t=>t.where(n=>n.or(n.cmp("userId",g.current.userID),n.exists("chatAccess",_=>_.where("userId",g.current.userID))))).whereExists("chunks",t=>t.where("content","ILIKE",`%${e(s)}%`)).related("chunks").related("chat")),m=re(()=>new Set([...N.current.map(t=>t.id),...u.current.map(t=>t.chatId)])),C=oe(()=>g.current.query.chats.where("id","IN",Array.from(e(m))).related("messages",t=>t.related("chunks")));function B(t){var n,_,X,H,I;(t.metaKey||t.ctrlKey)&&t.key==="k"&&(t.preventDefault(),(n=e(c))!=null&&n.open?(_=e(c))==null||_.close():(X=e(c))==null||X.showModal(),j(l,0),j(s,"")),(H=e(c))!=null&&H.open&&(t.key==="ArrowUp"?(t.preventDefault(),A("up")):t.key==="ArrowDown"?(t.preventDefault(),A("down")):t.key==="Enter"?(t.preventDefault(),G()):t.key==="Escape"&&((I=e(c))==null||I.close()))}He(()=>{e(s),j(l,0)}),Ze(()=>(j(c,ve(document.getElementById("searchModal"))),window.addEventListener("keydown",B),()=>{window.removeEventListener("keydown",B)}));const Q=[{label:"New Chat",icon:Me,action:()=>{var t;_e(`/${Fe()}`).then(()=>{var n;return(n=document.querySelector("textarea"))==null?void 0:n.focus()}),(t=e(c))==null||t.close()}},{label:"Share Chat",icon:Ue,action:()=>{var n;const t=ge.params.chatId;t&&(g.current.mutate.chats.update({id:t,public:!0}),navigator.clipboard.writeText(`${window.location.origin}/${t}`).then(()=>Ee("Link copied to clipboard!")),(n=e(c))==null||n.close())}},{label:"Edit Title",icon:Ye,action:()=>{var n,_,X;const t=ge.params.chatId;if(t){const H=g.current.query.chats.where("id",t).one().materialize();if(H){const I=prompt("Edit chat title:",((n=H.data)==null?void 0:n.title)??"New Chat");I&&I.trim()!==""&&I!==((_=H.data)==null?void 0:_.title)&&g.current.mutate.chats.update({id:t,title:I.trim()}).then(()=>Ee("Chat title updated!"))}}(X=e(c))==null||X.close()}},{label:"Delete Chat",icon:$e,action:()=>{var n;const t=ge.params.chatId;(n=e(c))==null||n.close(),_e("/"),g.current.mutate.chats.delete({id:t})}}],U=re(()=>Q.filter(t=>e(s).length===0||t.label.toLowerCase().includes(e(s).toLowerCase()))),x=re(()=>{const t=[];return e(U).forEach((n,_)=>{t.push({type:"shortcut",index:_})}),e(s).length>0&&C.current.length>0&&C.current.forEach((n,_)=>{t.push({type:"chat",index:_})}),t});function A(t){e(x).length!==0&&(t==="up"?j(l,(e(l)-1+e(x).length)%e(x).length):j(l,(e(l)+1)%e(x).length),setTimeout(()=>{const n=document.querySelector('[data-selected="true"]');n&&(n.scrollIntoView({block:"nearest"}),n.focus())},0))}function G(){var t;if(e(l)>=0&&e(l)<e(x).length){const n=e(x)[e(l)];n.type==="shortcut"?e(U)[n.index].action():n.type==="chat"&&(_e(`/${N.current[n.index].id}`),(t=e(c))==null||t.close())}}function d(t,n){if(e(l)===-1)return!1;const _=e(x)[e(l)];return _&&_.type===t&&_.index===n}var w=gt(),D=o(w),S=o(D);S.__click=[it,c];var z=v(S,2),k=o(z);Ie(k,{size:20}),r(z);var p=v(z,2);p.__click=[lt,c];var O=o(p);Ie(O,{size:20}),r(p),r(D);var V=v(D,2),T=o(V),y=o(T);Oe(y),je(y,!0);var M=v(y,2),J=o(M);Ie(J,{size:20}),r(M);var se=v(M,2),f=o(se);f.__click=[dt,c];var b=o(f);$e(b,{size:20}),r(f),r(se),r(T);var L=v(T,2),Y=o(L);{var ye=t=>{var n=vt(),_=v(o(n),2);fe(_,17,()=>e(U),me,(X,H,I)=>{var E=ut();E.__click=function(...P){var W;(W=e(H).action)==null||W.apply(this,P)},E.__mouseover=()=>j(l,ve(e(x).findIndex(P=>P.type==="shortcut"&&P.index===I)));var ee=o(E);Be(ee,()=>e(H).icon,(P,W)=>{W(P,{size:20})});var ue=v(ee);r(E),q((P,W)=>{xe(E,1,`flex items-center gap-2 py-1 px-3 rounded-md ${P??""} focus:bg-gray-100 focus:outline-none transition-colors duration-200 w-full text-left`),he(E,"data-selected",W),Z(ue,` ${e(H).label??""}`)},[()=>d("shortcut",I)?"bg-gray-100":"",()=>d("shortcut",I)]),Se("focus",E,()=>j(l,ve(e(x).findIndex(P=>P.type==="shortcut"&&P.index===I)))),i(X,E)}),r(n),i(t,n)};F(Y,t=>{e(U).length>0&&t(ye)})}var be=v(Y,2);{var de=t=>{var n=_t(),_=o(n);{var X=I=>{var E=mt(),ee=v(K(E),2);fe(ee,21,()=>C.current,me,(ue,P,W)=>{var we=ft(),te=o(we);te.__click=[ht,c],te.__mouseover=()=>j(l,ve(e(x).findIndex(ae=>ae.type==="chat"&&ae.index===W)));var Ae=o(te);ct(Ae,{get chat(){return e(P)},get search(){return e(s)}}),r(te),r(we),q((ae,Te)=>{he(te,"href",`/${e(P).id}`),xe(te,1,`flex items-center gap-2 py-1 px-3 rounded-md ${ae??""} focus:bg-gray-100 focus:outline-none transition-colors duration-200 w-full text-left`),he(te,"data-selected",Te)},[()=>d("chat",W)?"bg-gray-100":"",()=>d("chat",W)]),Se("focus",te,()=>j(l,ve(e(x).findIndex(ae=>ae.type==="chat"&&ae.index===W)))),i(ue,we)}),r(ee),i(I,E)},H=I=>{var E=pt(),ee=v(o(E),2),ue=o(ee,!0);r(ee),Pe(),r(E),q(()=>Z(ue,e(s))),i(I,E)};F(_,I=>{C.current.length>0?I(X):I(H,!1)})}r(n),i(t,n)};F(be,t=>{e(s).length>0&&t(de)})}r(L),r(V),r(w),Qe(y,()=>e(s),t=>j(s,t)),i(h,w),ze()}De(["click","mouseover"]);const Ne=(h,a=Le,s=Le)=>{var l=R(),c=K(l);{var N=u=>{var m=wt(),C=o(m),B=o(C,!0);r(C);var Q=v(C,2);fe(Q,21,s,me,(U,x)=>{var A=bt(),G=o(A),d=o(G),w=o(d);{var D=k=>{qe(k,{size:20})},S=k=>{Me(k,{size:20})};F(w,k=>{e(x).userId===g.current.userID?k(D):k(S,!1)})}var z=v(w);r(d),r(G),r(A),q(()=>{he(G,"href",`/${e(x).id}`),xe(G,1,`block p-2 rounded hover:bg-gray-700 ${(ge.url.pathname===`/${e(x).id}`?"bg-gray-700":"")??""}`),Z(z,` ${e(x).title??""}`)}),i(U,A)}),r(Q),r(m),q(()=>Z(B,a())),i(u,m)};F(c,u=>{s().length>0&&u(N)})}i(h,l)};var yt=$('<meta name="description" content="ZChat is a proof of concept LLM chat application built with Zero and Svelte and deployed on AWS using SST.">'),bt=$('<li><a><span class="flex items-center gap-2"><!> </span></a></li>'),wt=$('<div><h2 class="text-sm uppercase tracking-wider text-gray-400 font-semibold px-2 mb-2"> </h2> <ul class="space-y-2"></ul></div>'),kt=(h,a)=>j(a,!1),It=()=>_e(`/${Fe()}`),$t=(h,a)=>j(a,!0),Ct=()=>{document.cookie="auth=; Path=/; Max-Age=0; SameSite=Lax",window.location.href="/"},zt=$('<div class="flex items-center gap-4 ml-auto"><span class="text-sm font-medium text-gray-700 hidden md:inline-block"> </span> <img alt="Profile" class="size-8 rounded-full object-cover mr-2"></div> <button class="p-2 flex flex-row gap-2 items-center rounded-md text-white bg-[#FF3E00] hover:bg-[#FF5722] focus:outline-none focus:ring-2 focus:ring-[#FF3E00]"><span class="hidden md:inline-block">Logout</span> <!></button>',1),Mt=$('<a href="/api/auth" class="py-2 px-4 rounded-md text-white bg-[#FF3E00] hover:bg-[#FF5722] focus:outline-none focus:ring-2 focus:ring-[#FF3E00] inline-flex items-center gap-4 ml-auto">Login <!></a>'),St=$('<div class="min-h-dvh bg-gray-100"><aside><div class="h-16 px-4 border-b border-gray-700 flex justify-between items-center"><a href="/" class="flex items-center gap-2"><div class="bg-[url(&quot;/favicon.png&quot;)] bg-contain bg-no-repeat size-5"></div> <h1 class="text-xl font-bold">ZChat</h1></a> <button class="md:hidden p-2 rounded-md text-white active:bg-gray-700 focus:outline-none" aria-label="close sidebar"><!></button></div> <nav class="p-2 space-y-4"><button class="p-2 rounded hover:bg-gray-700 w-full"><span class="flex items-center gap-2"><!> Create New Chat</span></button> <!> <!></nav></aside> <div class="fixed inset-0 flex flex-col flex-1 md:ml-64"><header class="bg-white shadow-sm"><div class="flex items-center h-16 px-4 gap-4"><button class="md:hidden p-2 rounded-md text-gray-600 hover:text-gray-900 active:bg-gray-100 focus:outline-none" aria-label="toggle sidebar"><!></button> <!> <!></div></header> <main class="p-2 md:p-6 space-y-2 md:space-y-6 flex-1 overflow-y-auto overflow-x-hidden"><!></main></div></div>');function Ht(h,a){Ce(a,!0);let s=pe(!1);const l=re(()=>{var f;return!!((f=document.cookie.split("; ").find(b=>b.startsWith("auth=")))!=null&&f.split("=")[1])});g.current.query.chats.where(f=>f.or(f.cmp("userId",g.current.userID),f.exists("chatAccess",b=>b.where("userId",g.current.userID)))).related("messages",f=>f.related("chunks")).related("chatAccess").related("user").preload();const c=oe(()=>g.current.query.users.where("id",g.current.userID).one()),N=oe(()=>g.current.query.chats.where("userId",g.current.userID)),u=oe(()=>g.current.query.chats.whereExists("chatAccess",f=>f.where("userId",g.current.userID)));var m=St();Ke(f=>{var b=yt();Ge.title="ZChat",i(f,b)});var C=o(m),B=o(C),Q=v(o(B),2);Q.__click=[kt,s];var U=o(Q);$e(U,{}),r(Q),r(B);var x=v(B,2),A=o(x);A.__click=[It];var G=o(A),d=o(G);We(d,{}),Pe(),r(G),r(A);var w=v(A,2);Ne(w,()=>"My Chats",()=>N.current);var D=v(w,2);Ne(D,()=>"Shared With Me",()=>u.current),r(x),r(C);var S=v(C,2),z=o(S),k=o(z),p=o(k);p.__click=[$t,s];var O=o(p);Je(O,{}),r(p);var V=v(p,2);xt(V,{});var T=v(V,2);{var y=f=>{var b=zt(),L=K(b),Y=o(L),ye=o(Y,!0);r(Y);var be=v(Y,2);r(L);var de=v(L,2);de.__click=[Ct];var t=v(o(de),2);et(t,{size:20}),r(de),q(()=>{var n,_;Z(ye,(n=c.current)==null?void 0:n.name),he(be,"src",`https://github.com/${(_=c.current)==null?void 0:_.username}.png`)}),i(f,b)},M=f=>{var b=Mt(),L=v(o(b));Re(L,{}),r(b),i(f,b)};F(T,f=>{e(l)?f(y):f(M,!1)})}r(k),r(z);var J=v(z,2),se=o(J);Ve(se,()=>a.children),r(J),r(S),r(m),q(()=>xe(C,1,`fixed left-0 inset-y-0 z-50 w-64 bg-gray-800 text-white ${(e(s)?"translate-x-0":"-translate-x-full")??""} md:translate-x-0 transition-transform duration-300 ease-in-out`)),i(h,m),ze()}De(["click"]);export{Ht as component,Kt as universal};
